<navbar></navbar>
<h1 class="center">{{ titulo }}</h1>
<div class="m-3 card ">
    <div class="loading" *ngIf="loading">Loading&#8230;</div>
    <form class="m-3" [formGroup]="gastosForm" (ngSubmit)="onSubmit()">
        <div class="around">
            <div class="mt-3 col-md-3">
                <label class="control-label" for="proyecto">Proyecto:</label><br>
                <select id="proyecto" class="form-control" formControlName="proyecto" (change)="valor(gastosForm.value.proyecto)">
                    <option disabled value=''>Proyecto</option>
                    <option *ngFor="let proyecto of proyectos" >{{proyecto.nombre}} </option>
                  </select>
                <p id="error" *ngIf="submitted && fval.proyecto.invalid">*Este campo no puede ir vacío</p>
            </div>
            <br>
            <div class="mt-3 col-md-3">
                <label class="control-label" for="fecha">Fecha: <span><i class="far fa-calendar-alt "></i></span> </label>
                <input class="form-control" id="fecha" min="proyecto.fechaini" formControlName="fecha" type="date" data-toggle="tooltip " title="*Campo obligatorio ">
                <p #error id="error" *ngIf="submitted && fval.fecha.invalid" class="mt-2">*Este campo no puede ir vacío</p>
            </div>
            <br>
            <div class="mt-3 col-md-3">
                <label class="control-label" for="montodisp">Monto Disponible: </label>
                <input disabled class="form-control-sm" id="montodisp" value="{{saldoDisp |currency}}" type="text">
            </div>
        </div><br>
        <div class="around">
            <div class="mt-3 class">
                <label class="control-label " for="monto ">Monto: </label>
                <input class="form-control " id="monto" placeholder="Monto" formControlName="cantidad" type="text" data-toggle="tooltip " title="*Campo obligatorio " (keyup)="checkNumeros($event) " [ngClass]="{ 'is-invalid': submitted && fval.cantidad.errors } ">
            </div>
            <div class="mt-3 class ">
                <label class="control-label" for="motivo">Motivo: </label>
                <input class="form-control" id="motivo" placeholder="Motivo" formControlName="motivo" type="text" data-toggle="tooltip" title="*Campo obligatorio " (keyup)="checkL_N($event) " [ngClass]="{ 'is-invalid': submitted && fval.motivo.errors } ">
            </div>
        </div><br>
        <div class="around">
            <div class="mt-3 col-md-3">
                <label class="control-label mr-2" for="tipo_gasto">Tipo gasto:</label><br>
                <select id="tipo_gasto" class="selector" formControlName="tipo_gasto">
                <option disabled value=''>Tipo gasto</option>
                <option *ngFor="let gto of tipoGto " >{{gto.gasto}}</option>
              </select>
                <p id="error" *ngIf="submitted && fval.tipo_gasto.invalid">*Este campo no puede ir vacío</p>
            </div>
            <br>
            <div class="mt-3 col-md-3">
                <label class="control-label">Reembolso: </label><br>
                <label class="switch">
                        <input type="checkbox" name="check" id="check" formControlName="reembolso">
                        <span class="slider round"></span>
                      </label>
            </div>
            <br>
            <div class="mt-3 col-md-3">
                <label class="control-label mr-2" for="estatus">Estatus:</label><br>
                <select id="estatus" formControlName="estatus">
                    <option *ngIf="!aprobador && !id_gasto" value="Solicitar">Solicitar</option>
                    <option  disabled value='Aprobado'>Aprobado</option>
                    <option *ngIf="!aprobador" value="Pagado">Pagado</option>
                  </select>
                <p id="error" *ngIf="submitted && fval.estatus.invalid">*Este campo no puede ir vacío</p>
            </div>

        </div> <br>
        <label class="class ml-5" *ngIf="!id_gasto">Subir comprobantes: </label><br>
        <div *ngIf="!id_gasto" class="around">
            <div *ngIf="(archivos.length <=  2)" class="drop-img mt-3 col-md-4">
                <div appNgDropFiles [archivos]="archivos" (mouseSobre)="estaSobreElemento = $event; cargarArchivos();" [ngClass]="{ 'file-over': estaSobreElemento }" class="well drop-zone">

                    <div id="filesButton">
                        <input id="fichero" type="file" accept="image/*; application/pdf;'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet';'application/vnd.ms-excel'" (change)="botonFiles($event)">
                        <label for="fichero" class="circle"></label>
                    </div>
                </div>
                <br>
            </div>
            <br>
            <div id="tabla" class=" mt-3 col-md-4">
                <table class="table mt-3" *ngIf="archivos.length > 0">
                    <thead>
                        <tr>
                            <th *ngFor="let ht of headTitle"> {{ht}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let archivo of archivos">
                            <td>{{archivo.nombreArchivo}}
                            </td>
                            <td>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" [ngStyle]="{'width': archivo.progreso + '%', 'background-color':  archivo.completo?'green':'blue' }" aria-valuenow="{{ archivo.progreso }}" aria-valuemin="0" aria-valuemax="100">{{archivo.progreso}} </div>
                                </div>
                                <i class="fas fa-times btn-outline-danger" (click)="limpiarArchivos(archivos,archivo)"></i>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <br>
        <div *ngIf="actualizar" class="center mt-3">
            <button type="button" id="cancelar" class="btn btn-outline-danger mr-4" (click)="regresar()"><i class="mr-3 fas fa-times"></i>
                Cancelar</button>
            <button type="submit" id="eliminar" class="btn btn-outline-warning"><i class="mr-3 fas fa-sync-alt"></i>
                    Actualizar</button>
        </div>
        <div class="center mt-3">
            <button #guardar *ngIf="!actualizar" type="submit" id="guardar" class="col-md-5"><i class="mr-3 fas fa-cloud-download-alt"></i>
                {{boton}}</button>
        </div>
    </form>

</div>